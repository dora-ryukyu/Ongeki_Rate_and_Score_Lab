<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="format-detection" content="telephone=no">
    <title>Ongeki Rate & Score Lab</title>
    <link rel="icon" href="favicon.ico" sizes="any">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- CSSファイルをリンク -->
    <link rel="stylesheet" href="style.css">
    <script src="https://unpkg.com/feather-icons"></script>
</head>
<body data-theme="dark">

    <header class="header">
        <h1>Ongeki<span> Rate & Score Lab</span></h1>
    </header>

    <!-- 主要コンテンツをmainで囲む -->
    <main class="calculator">
        <div class="search-container">
            <input type="search" id="song-search" placeholder="曲名、譜面定数で検索...">
            <div id="search-results" aria-live="polite"></div>
        </div>

        <div id="loading-indicator" role="status">データをロード中...</div>

        <div id="calculator-core" style="display: none;"> <!-- 初期状態では非表示にしておく -->
            <div class="mode-switch" data-active-mode="score" role="tablist">
                <button class="mode-btn active" data-mode="score" role="tab" aria-selected="true">Score → Rate</button>
                <button class="mode-btn" data-mode="rate" role="tab" aria-selected="false">Rate → Score</button>
            </div>

            <!-- Score to Rate Mode Panel -->
            <div class="input-group score-mode" role="tabpanel">
                <div class="input-field">
                    <label for="score-chart">譜面定数 <span class="chart-info" id="score-chart-info"></span></label>
                    <input type="number" id="score-chart" placeholder="譜面選択 or 直接入力 (1.0-15.7)" min="1.0" max="15.7" step="0.1">
                    <div class="input-error" id="score-chart-error"></div>
                </div>
                <div class="input-field">
                    <label for="score">スコア</label>
                    <input type="number" id="score" placeholder="例: 1007500" min="0" max="1010000">
                    <div class="input-error" id="score-error"></div>
                </div>
                <fieldset class="bonus-section">
                    <legend>達成ボーナス</legend>
                    <div class="bonus-controls">
                        <div class="input-field">
                            <label for="score-lamp-bonus">ランプ</label>
                            <select id="score-lamp-bonus">
                                <option value="0">未達成</option>
                                <option value="0.100">FC</option>
                                <option value="0.300">AB</option>
                                <option value="0.350">AB+</option>
                            </select>
                        </div>
                        <div class="checkbox-container">
                            <input type="checkbox" id="score-fb-bonus" value="0.050">
                            <label for="score-fb-bonus">FULL BELL</label>
                        </div>
                    </div>
                </fieldset>
            </div>

            <!-- Rate to Score Mode Panel -->
            <div class="input-group rate-mode" style="display:none;" role="tabpanel">
                <div class="input-field">
                    <label for="chart">譜面定数 <span class="chart-info" id="chart-info"></span></label>
                    <input type="number" id="chart" placeholder="譜面選択 or 直接入力 (1.0-15.7)" min="1.0" max="15.7" step="0.1">
                    <div class="input-error" id="chart-error"></div>
                </div>
                <div class="input-field">
                    <label for="target-rate">目標レート</label>
                    <input type="number" id="target-rate" placeholder="例: 15.50" min="0" max="18.4" step="0.01">
                    <div class="input-error" id="rate-error"></div>
                </div>
                <fieldset class="bonus-section">
                    <legend>達成ボーナス</legend>
                    <div class="bonus-controls">
                        <div class="input-field">
                            <label for="rate-lamp-bonus">ランプ</label>
                            <select id="rate-lamp-bonus">
                                <option value="0">未達成</option>
                                <option value="0.100">FC</option>
                                <option value="0.300">AB</option>
                                <option value="0.350">AB+</option>
                            </select>
                        </div>
                        <div class="checkbox-container">
                            <input type="checkbox" id="rate-fb-bonus" value="0.050">
                            <label for="rate-fb-bonus">FULL BELL</label>
                        </div>
                    </div>
                </fieldset>
            </div>
        </div>

        <div class="result" aria-live="polite">
            <h2 id="result-text" class="info"><i data-feather="info"></i><span>譜面を選択または定数を入力してください</span></h2>
        </div>
    </main>

    <footer class="footer">
        <p><a href="https://github.com/dora-ryukyu/Ongeki_Rate_and_Score_Lab/" target="_blank" rel="noopener noreferrer">GitHub Repository</a></p>
        <p><small>Music data provided by <a href="https://reiwa.f5.si/" target="_blank" rel="noopener noreferrer">reiwa.f5.si</a></small></p>
    </footer>

    <!-- JavaScriptファイルをdeferで読み込み -->
    <script src="script.js" defer></script>
</body>
</html>
